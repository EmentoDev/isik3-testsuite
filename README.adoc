= image:imgs/gematik.png[Gematik] ISiK Stufe 3 Validierungstestsuite
:toc: 1
:icons: font
:icontype: svg

== Übersicht

Dieses Projekt verwendet die Tiger Testsuite, um Validierungstests zu automatisieren.
Es verbindet sich mit dem Primärsystem über eine zur Verfügung gestellte URL und sendet und validiert Testnachrichten.
Tiger zeichnet alle Datennachrichten auf und stellen deren Inhalte übersichtlich als strukturierten HTML Bericht dar.

== Funktionen

Die vorliegende Tiger Testintegration für Isik-Stufe-3 ist in der Lage alle fünf Kataloge (Basismodul, Dokumentenaustausch, Medikation, Terminplanung und Vitalparameter) abzutesten.

Jeder Katalog kann einzeln, oder in Kombination mit anderen Katalogen validiert werden.
Des Weiteren gibt es optionale Tests, die zusätzlich ausgeführt werden können, um eine noch höhere Testabdeckung zu erreichen.
Jeder Test kann auch einzel ausgeführt werden.
Genauere Informationen zur Ausführung der Tests im Kapitel <<testRun_section>>.

Bei Ausführung der Tests öffnet sich eine Weboberfläche, in der die laufenden Tests und deren Status überwacht werden kann.
Nähere Informationen zur Tiger-Weboberfläche findet man im https://gematik.github.io/app-Tiger/Tiger-User-Manual.html#_tiger_user_interfaces[Tiger Usermanual].

Nach jedem Durchlauf wird ein ausführlicher Testbericht erstellt und lokal im Ordner /tiger-integration-isik-stufe-3/target/site/serenity/index.html abgelegt.
Dieser Ordner wird nach der ersten <<testRun_section,Ausführung>> erstellt.

== Konfiguration [[config_section,Konfiguration]]

=== Verbindung zum Primärsystem

Die zentrale Konfigurationsdatei befindet sich unter src/test/resources/testdata/tiger.yaml.
Dort muss unter `servers.fhirserver.source` der Wert 'http://localhost:9032' gelöscht und stattdessen die URL des Primärsystems angegeben werden.

=== Test-Ressourcen

Für jeden der fünf Testkataloge müssen Test-Ressourcen konfiguriert werden.
Die IDs dieser Ressourcen können im yaml Format unter src/test/resources/testdata und dem jeweiligen Katalognamen hinterlegt werden.
Es müssen nur die Testkataloge konfiguriert werden, die auch ausgeführt werden.

== Test Ausführung [[testRun_section,Test Ausführung]]

Nachdem dieses Repository lokal geklont wurde und alle <<config_section,Konfigurationen>> abgeschlossen sind können die Tests über die Konsole mit `mvn verify` gestartet werden.
Es wird sich eine grafische Oberfläche im Browser öffnen, die eine Übersicht der Testfälle und deren Status anzeigt.

=== Tests anhand von Tags ausführen

Es ist möglich ein Subset von Tests auszuführen.
Dafür sind allen Test ein oder mehrere Tags zugeordnet.
Mit dem Befehl `mvn -P` + den gewünschten Tag, können diese Subsets an Tests ausgeführt werden.

==== Alle Kataloge

`mvn -P all` führt alle Tests von ISIK Stufe 3 aus, die für eine Verifizierung notwendig sind.

==== Basis Katalog

`mvn -P basis,mandatory` führt alle Tests des Katalogs Basis aus, die für eine Verifizierung notwendig sind.
`mvn -P basis,optional` führt nur die Tests des Katalogs Basis aus, die für eine Verifizierung nicht notwendig sind.

==== Dokumentenaustausch Katalog

`mvn -P dokumentenaustausch,mandatory` führt alle Tests des Katalogs Dokumentenaustausch aus, die für eine Verifizierung notwendig sind.
`mvn -P dokumentenaustausch,optional` führt nur die Tests des Katalogs Dokumentenaustausch aus, die für eine Verifizierung nicht notwendig sind.

==== Medikation Katalog

`mvn -P medikation,mandatory` führt alle Tests des Katalogs Medikation aus, die für eine Verifizierung notwendig sind.
`mvn -P medikation,optional` führt nur die Tests des Katalogs Medikation aus, die für eine Verifizierung nicht notwendig sind.

==== Terminplanung Katalog

`mvn -P terminplanung,mandatory` führt alle Tests des Katalogs Terminplanung aus, die für eine Verifizierung notwendig sind.
`mvn -P terminplanung,optional` führt nur die Tests des Katalogs Terminplanung aus, die für eine Verifizierung nicht notwendig sind.

==== Vitalparameter Katalog

`mvn -P vitalparameter,mandatory` führt alle Tests des Katalogs Vitalparameter aus, die für eine Verifizierung notwendig sind.
`mvn -P vitalparameter,optional` führt nur die Tests des Katalogs Vitalparameter aus, die für eine Verifizierung nicht notwendig sind.

==== Mehrere Kataloge

Sollen mehrere Kataloge, aber nicht alle ausgeführt werden, so lassen sie sich durch eine komma-separierte Liste ausführen.
Dabei ist zu beachten, dass auch *immer entweder mandatory oder optional* mit angegeben werden muss.

Z.B. `mvn -P basis,terminplanung,mandatory` führt alle Tests der Kataloge Basis und Terminplanung aus, die für eine Verifizierung notwendig sind.

Z.B. `mvn -P dokumentenaustausch,terminplanung,medikation,optional` führt alle Tests der Kataloge Dokumentenaustausch, Medikation und Terminplanung aus, die für eine Verifizierung nicht zwingend notwendig sind.

==== Einzelne Tests Ausführen

Zur wiederholten Abtestung kann ein Feature-File einzeln abgespielt werden.
Dazu wurde jedes Feature mit einem Tag versehen.

Soll beispielsweise nur der Lesezugriff auf die Ressource Patient getestet werden, navigiert man in der Weboberfläche zu den fraglichen Tests und findet dort in der Überschrift _Feature: Lesen der Ressource Patient (@Patient-Read)_ den Tag '@Patient-Read-Extended'.
In der Konsole kann das Feature-File nun einzeln ausgeführt werden mit dem Befehl `mvn clean verify -Dcucumber.filter.tags="@Patient-Read"`

== License

Copyright 2023 gematik GmbH

Licensed under the Apache License, Version 2.0 (the "License"); you may not use this file except in compliance with the License.

See the link:./LICENSE[LICENSE] for the specific language governing permissions and limitations under the License.

Unless required by applicable law the software is provided "as is" without warranty of any kind, either express or implied, including, but not limited to, the warranties of fitness for a particular purpose, merchantability, and/or non-infringement.
The authors or copyright holders shall not be liable in any manner whatsoever for any damages or other claims arising from, out of or in connection with the software or the use or other dealings with the software, whether in an action of contract, tort, or otherwise.

The software is the result of research and development activities, therefore not necessarily quality assured and without the character of a liable product.
For this reason, gematik does not provide any support or other user assistance (unless otherwise stated in individual cases and without justification of a legal obligation).
Furthermore, there is no claim to further development and adaptation of the results to a more current state of the art.

Gematik may remove published results temporarily or permanently from the place of publication at any time without prior notice or justification.